<canvas id="visualizer" width="500" height="300" style="background:black;"></canvas>
<input type="file" id="audioFile" accept="audio/*">
<button id="startRadio">Start Radio</button>

<audio id="radio" crossorigin="anonymous" controls>
  <source src="https://icecast.omroep.nl/radio2-bb-mp3" type="audio/mpeg">
</audio>


<script>
const canvas = document.getElementById('visualizer');
const ctx = canvas.getContext('2d');
const fileInput = document.getElementById('audioFile');
const radio = document.getElementById('radio');
const startRadioBtn = document.getElementById('startRadio');

function startVisualizer(audio) {
  console.log("Visualizer gestart voor:", audio.src);

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioCtx.createMediaElementSource(audio);
  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0.6;

  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / bufferLength;
    for (let i = 0; i < bufferLength; i++) {
      const value = dataArray[i];
      const y = (value / 255) * canvas.height;
      ctx.fillStyle = 'lime';
      ctx.fillRect(i * barWidth, canvas.height - y, barWidth, y);
    }
  }
  draw();
}

// MP3-bestand afspelen
fileInput.addEventListener('change', function () {
  const file = this.files[0];
  if (!file) return;

  const audio = new Audio();
  audio.src = URL.createObjectURL(file);
  audio.controls = true;
  document.body.appendChild(audio);

  audio.play().then(() => {
    console.log("MP3 speelt!");
    startVisualizer(audio);
  }).catch(err => console.error("Fout bij mp3 afspelen:", err));
});

// Radiostream afspelen
startRadioBtn.addEventListener('click', function () {
  radio.play().then(() => {
    console.log("Radio speelt!");
    startVisualizer(radio);
  }).catch(err => console.error("Fout bij radio afspelen:", err));
});
</script>
